<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“å­—èµ›è½¦æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 48px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            opacity: 0.9;
        }

        .stats-panel {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .stat-item {
            text-align: center;
            color: white;
        }

        .stat-item label {
            display: block;
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-item .value {
            font-size: 36px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .race-track {
            background: #2d2d2d;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .race-track::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 50px,
                rgba(255,255,255,0.1) 50px,
                rgba(255,255,255,0.1) 100px
            );
            animation: roadAnimation 1s linear infinite;
        }

        @keyframes roadAnimation {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-100px);
            }
        }

        .lane {
            position: relative;
            height: 80px;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border-left: 5px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
        }

        .lane:last-child {
            margin-bottom: 0;
        }

        .lane-label {
            position: absolute;
            left: 15px;
            top: 5px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            opacity: 0.7;
            z-index: 10;
        }

        .car {
            position: absolute;
            left: 20px;
            font-size: 40px;
            transition: left 0.2s ease-out;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
            z-index: 5;
            transform: scaleX(-1);
        }

        .finish-line {
            position: absolute;
            right: 10px;
            top: 0;
            bottom: 0;
            width: 5px;
            background: repeating-linear-gradient(
                45deg,
                #fff,
                #fff 10px,
                #000 10px,
                #000 20px
            );
        }

        .typing-area {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .current-letter {
            text-align: center;
            margin-bottom: 20px;
        }

        .current-letter .label {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .current-letter .letter {
            font-size: 120px;
            font-weight: bold;
            color: #2a5298;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .letter-sequence {
            text-align: center;
            font-size: 24px;
            color: #333;
            letter-spacing: 8px;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 40px;
        }

        .letter-sequence .typed {
            color: #4CAF50;
        }

        .letter-sequence .current {
            color: #2a5298;
            background: rgba(42, 82, 152, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .letter-sequence .pending {
            color: #999;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .btn-start {
            background: #4CAF50;
            color: white;
        }

        .btn-start:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .btn-reset {
            background: #f44336;
            color: white;
        }

        .btn-reset:hover {
            background: #da190b;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .settings {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            backdrop-filter: blur(10px);
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .setting-item label {
            font-size: 14px;
            font-weight: bold;
        }

        .setting-item select,
        .setting-item input {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            font-size: 14px;
            font-weight: bold;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 1000;
            min-width: 400px;
        }

        .game-over h2 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .game-over .result {
            font-size: 32px;
            margin-bottom: 30px;
        }

        .game-over .winner {
            color: #FFD700;
        }

        .game-over .loser {
            color: #ff6b6b;
        }

        .game-over .stats {
            text-align: left;
            margin-bottom: 30px;
            font-size: 18px;
        }

        .game-over .stats p {
            margin: 10px 0;
        }

        .countdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 150px;
            color: white;
            font-weight: bold;
            text-shadow: 5px 5px 10px rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
            animation: countdownPulse 1s ease-in-out;
        }

        @keyframes countdownPulse {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸï¸ æ‰“å­—èµ›è½¦æ¸¸æˆ</h1>
            <p>å¿«é€Ÿæ‰“å­—ï¼Œè¶…è¶Šå¯¹æ‰‹ï¼</p>
        </div>

        <div class="stats-panel">
            <div class="stat-item">
                <label>é€Ÿåº¦ (WPM)</label>
                <div class="value" id="wpm">0</div>
            </div>
            <div class="stat-item">
                <label>å‡†ç¡®ç‡</label>
                <div class="value" id="accuracy">100%</div>
            </div>
            <div class="stat-item">
                <label>è¿›åº¦</label>
                <div class="value" id="progress">0/30</div>
            </div>
        </div>

        <div class="race-track">
            <div class="lane">
                <div class="lane-label">ä½ </div>
                <div class="car" id="playerCar">ğŸï¸</div>
                <div class="finish-line"></div>
            </div>
            <div class="lane" id="aiLane1">
                <div class="lane-label">ç”µè„‘ 1</div>
                <div class="car" id="aiCar1">ğŸš—</div>
                <div class="finish-line"></div>
            </div>
            <div class="lane" id="aiLane2">
                <div class="lane-label">ç”µè„‘ 2</div>
                <div class="car" id="aiCar2">ğŸš™</div>
                <div class="finish-line"></div>
            </div>
            <div class="lane" id="aiLane3">
                <div class="lane-label">ç”µè„‘ 3</div>
                <div class="car" id="aiCar3">ğŸš•</div>
                <div class="finish-line"></div>
            </div>
        </div>

        <div class="typing-area">
            <div class="current-letter">
                <div class="label">è¾“å…¥è¿™ä¸ªå­—æ¯ï¼š</div>
                <div class="letter" id="currentLetter">A</div>
            </div>
            <div class="letter-sequence" id="letterSequence"></div>
        </div>

        <div class="controls">
            <button class="btn btn-start" id="startBtn">å¼€å§‹æ¯”èµ›</button>
            <button class="btn btn-reset" id="resetBtn">é‡ç½®</button>
        </div>

        <div class="settings">
            <div class="setting-item">
                <label>å­—æ¯æ•°é‡ï¼š</label>
                <select id="letterCount">
                    <option value="20">20 å­—æ¯</option>
                    <option value="30" selected>30 å­—æ¯</option>
                    <option value="50">50 å­—æ¯</option>
                    <option value="100">100 å­—æ¯</option>
                </select>
            </div>
            <div class="setting-item">
                <label>å­—æ¯èŒƒå›´ï¼š</label>
                <select id="letterRange">
                    <option value="basic">åŸºç¡€ (ASDF)</option>
                    <option value="homerow">ä¸­æ’ (ASDFGHJKL)</option>
                    <option value="full" selected>å…¨å­—æ¯ (A-Z)</option>
                </select>
            </div>
            <div class="setting-item">
                <label>AIéš¾åº¦ï¼š</label>
                <select id="aiDifficulty">
                    <option value="easy">ç®€å•</option>
                    <option value="medium" selected>ä¸­ç­‰</option>
                    <option value="hard">å›°éš¾</option>
                    <option value="expert">ä¸“å®¶</option>
                </select>
            </div>
        </div>
    </div>

    <div class="countdown" id="countdown">3</div>

    <div class="game-over" id="gameOver">
        <h2 id="gameOverTitle">æ¯”èµ›ç»“æŸï¼</h2>
        <div class="result" id="gameResult"></div>
        <div class="stats">
            <p>ä½ çš„é€Ÿåº¦: <strong id="finalWPM">0</strong> WPM</p>
            <p>å‡†ç¡®ç‡: <strong id="finalAccuracy">100</strong>%</p>
            <p>ç”¨æ—¶: <strong id="finalTime">0</strong> ç§’</p>
            <p>æ€»å­—æ¯æ•°: <strong id="finalTotal">0</strong></p>
            <p>é”™è¯¯æ•°: <strong id="finalErrors">0</strong></p>
        </div>
        <button class="btn btn-start" onclick="resetGame()">å†æ¥ä¸€å±€</button>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            isRunning: false,
            isPaused: false,
            letterSequence: [],
            currentIndex: 0,
            startTime: null,
            correctCount: 0,
            errorCount: 0,
            totalLetters: 30,
            letterRange: 'full',
            aiDifficulty: 'medium',
            playerProgress: 0,
            aiProgress: [0, 0, 0],
            aiIntervals: [],
            playerFinished: false,
            raceFinished: false
        };

        // å­—æ¯èŒƒå›´é…ç½®
        const letterRangeConfig = {
            basic: 'ASDF',
            homerow: 'ASDFGHJKL',
            full: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
        };

        // AIéš¾åº¦é…ç½® (æ¯æ¬¡ç§»åŠ¨çš„é—´éš”ï¼Œæ¯«ç§’)
        const aiDifficultyConfig = {
            easy: { min: 800, max: 1200 },
            medium: { min: 500, max: 800 },
            hard: { min: 350, max: 600 },
            expert: { min: 250, max: 450 }
        };

        // DOMå…ƒç´ 
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const currentLetterEl = document.getElementById('currentLetter');
        const letterSequenceEl = document.getElementById('letterSequence');
        const playerCar = document.getElementById('playerCar');
        const aiCars = [
            document.getElementById('aiCar1'),
            document.getElementById('aiCar2'),
            document.getElementById('aiCar3')
        ];
        const wpmEl = document.getElementById('wpm');
        const accuracyEl = document.getElementById('accuracy');
        const progressEl = document.getElementById('progress');
        const gameOverEl = document.getElementById('gameOver');
        const countdownEl = document.getElementById('countdown');
        const letterCountSelect = document.getElementById('letterCount');
        const letterRangeSelect = document.getElementById('letterRange');
        const aiDifficultySelect = document.getElementById('aiDifficulty');

        // ç”Ÿæˆéšæœºå­—æ¯åºåˆ—
        function generateLetterSequence() {
            const letters = letterRangeConfig[gameState.letterRange];
            gameState.letterSequence = [];
            for (let i = 0; i < gameState.totalLetters; i++) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                gameState.letterSequence.push(randomLetter);
            }
            updateLetterSequenceDisplay();
        }

        // æ›´æ–°å­—æ¯åºåˆ—æ˜¾ç¤º
        function updateLetterSequenceDisplay() {
            let html = '';
            gameState.letterSequence.forEach((letter, index) => {
                if (index < gameState.currentIndex) {
                    html += `<span class="typed">${letter}</span>`;
                } else if (index === gameState.currentIndex) {
                    html += `<span class="current">${letter}</span>`;
                } else {
                    html += `<span class="pending">${letter}</span>`;
                }
            });
            letterSequenceEl.innerHTML = html;

            // æ›´æ–°å½“å‰å­—æ¯æ˜¾ç¤º
            if (gameState.currentIndex < gameState.letterSequence.length) {
                currentLetterEl.textContent = gameState.letterSequence[gameState.currentIndex];
            }
        }

        // æ›´æ–°èµ›è½¦ä½ç½®
        function updateCarPosition(car, progress) {
            const maxPosition = car.parentElement.offsetWidth - 80;
            const position = 20 + (maxPosition * progress);
            car.style.left = position + 'px';
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            // è®¡ç®—WPM (å‡è®¾æ¯ä¸ªå­—æ¯ä½œä¸ºä¸€ä¸ª"å•è¯")
            const timeElapsed = (Date.now() - gameState.startTime) / 1000 / 60; // åˆ†é’Ÿ
            const wpm = timeElapsed > 0 ? Math.round(gameState.correctCount / timeElapsed) : 0;
            wpmEl.textContent = wpm;

            // è®¡ç®—å‡†ç¡®ç‡
            const total = gameState.correctCount + gameState.errorCount;
            const accuracy = total > 0 ? Math.round((gameState.correctCount / total) * 100) : 100;
            accuracyEl.textContent = accuracy + '%';

            // æ›´æ–°è¿›åº¦
            progressEl.textContent = `${gameState.currentIndex}/${gameState.totalLetters}`;

            // æ›´æ–°ç©å®¶èµ›è½¦ä½ç½®
            gameState.playerProgress = gameState.currentIndex / gameState.totalLetters;
            updateCarPosition(playerCar, gameState.playerProgress);
        }

        // AIç§»åŠ¨
        function startAI() {
            const difficulty = aiDifficultyConfig[gameState.aiDifficulty];

            aiCars.forEach((car, index) => {
                const randomInterval = Math.random() * (difficulty.max - difficulty.min) + difficulty.min;

                const interval = setInterval(() => {
                    if (gameState.raceFinished) {
                        clearInterval(interval);
                        return;
                    }

                    gameState.aiProgress[index] += (1 / gameState.totalLetters);

                    if (gameState.aiProgress[index] >= 1) {
                        gameState.aiProgress[index] = 1;
                        updateCarPosition(car, 1);
                        clearInterval(interval);
                        checkRaceFinished();
                    } else {
                        updateCarPosition(car, gameState.aiProgress[index]);
                    }
                }, randomInterval);

                gameState.aiIntervals.push(interval);
            });
        }

        // æ£€æŸ¥æ¯”èµ›æ˜¯å¦ç»“æŸ
        function checkRaceFinished() {
            if (gameState.raceFinished) return;

            if (gameState.playerFinished || gameState.aiProgress.some(p => p >= 1)) {
                gameState.raceFinished = true;
                endGame();
            }
        }

        // å¤„ç†é”®ç›˜è¾“å…¥
        function handleKeyPress(event) {
            if (!gameState.isRunning || gameState.raceFinished) return;

            const key = event.key.toUpperCase();
            const expectedLetter = gameState.letterSequence[gameState.currentIndex];

            if (key === expectedLetter) {
                gameState.correctCount++;
                gameState.currentIndex++;

                if (gameState.currentIndex >= gameState.totalLetters) {
                    gameState.playerFinished = true;
                    gameState.playerProgress = 1;
                    updateCarPosition(playerCar, 1);
                    checkRaceFinished();
                } else {
                    updateLetterSequenceDisplay();
                    updateStats();
                }
            } else if (key.match(/[A-Z]/)) {
                gameState.errorCount++;
                updateStats();
            }
        }

        // å€’è®¡æ—¶
        async function countdown() {
            countdownEl.style.display = 'block';

            for (let i = 3; i > 0; i--) {
                countdownEl.textContent = i;
                countdownEl.style.animation = 'none';
                setTimeout(() => {
                    countdownEl.style.animation = 'countdownPulse 1s ease-in-out';
                }, 10);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            countdownEl.textContent = 'GO!';
            countdownEl.style.animation = 'none';
            setTimeout(() => {
                countdownEl.style.animation = 'countdownPulse 1s ease-in-out';
            }, 10);

            await new Promise(resolve => setTimeout(resolve, 500));
            countdownEl.style.display = 'none';
        }

        // å¼€å§‹æ¸¸æˆ
        async function startGame() {
            if (gameState.isRunning) return;

            // ä¿å­˜è®¾ç½®
            gameState.totalLetters = parseInt(letterCountSelect.value);
            gameState.letterRange = letterRangeSelect.value;
            gameState.aiDifficulty = aiDifficultySelect.value;

            // ç¦ç”¨è®¾ç½®
            letterCountSelect.disabled = true;
            letterRangeSelect.disabled = true;
            aiDifficultySelect.disabled = true;
            startBtn.disabled = true;

            // ç”Ÿæˆå­—æ¯åºåˆ—
            generateLetterSequence();

            // å€’è®¡æ—¶
            await countdown();

            // å¼€å§‹æ¸¸æˆ
            gameState.isRunning = true;
            gameState.startTime = Date.now();
            startAI();
            updateStats();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // æ¸…ç†AIå®šæ—¶å™¨
            gameState.aiIntervals.forEach(interval => clearInterval(interval));

            // é‡ç½®çŠ¶æ€
            gameState = {
                isRunning: false,
                isPaused: false,
                letterSequence: [],
                currentIndex: 0,
                startTime: null,
                correctCount: 0,
                errorCount: 0,
                totalLetters: parseInt(letterCountSelect.value),
                letterRange: letterRangeSelect.value,
                aiDifficulty: aiDifficultySelect.value,
                playerProgress: 0,
                aiProgress: [0, 0, 0],
                aiIntervals: [],
                playerFinished: false,
                raceFinished: false
            };

            // é‡ç½®UI
            letterCountSelect.disabled = false;
            letterRangeSelect.disabled = false;
            aiDifficultySelect.disabled = false;
            startBtn.disabled = false;
            gameOverEl.style.display = 'none';

            // é‡ç½®èµ›è½¦ä½ç½®
            updateCarPosition(playerCar, 0);
            aiCars.forEach(car => updateCarPosition(car, 0));

            // é‡ç½®ç»Ÿè®¡
            wpmEl.textContent = '0';
            accuracyEl.textContent = '100%';
            progressEl.textContent = `0/${gameState.totalLetters}`;

            // é‡ç½®æ˜¾ç¤º
            currentLetterEl.textContent = 'A';
            letterSequenceEl.innerHTML = '';
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameState.isRunning = false;

            // æ¸…ç†AIå®šæ—¶å™¨
            gameState.aiIntervals.forEach(interval => clearInterval(interval));

            // è®¡ç®—æœ€ç»ˆç»Ÿè®¡
            const timeElapsed = (Date.now() - gameState.startTime) / 1000;
            const wpm = Math.round((gameState.correctCount / timeElapsed) * 60);
            const total = gameState.correctCount + gameState.errorCount;
            const accuracy = total > 0 ? Math.round((gameState.correctCount / total) * 100) : 100;

            // åˆ¤æ–­æ’å
            let playerRank = 1;
            gameState.aiProgress.forEach(progress => {
                if (progress > gameState.playerProgress) {
                    playerRank++;
                }
            });

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('finalWPM').textContent = wpm;
            document.getElementById('finalAccuracy').textContent = accuracy;
            document.getElementById('finalTime').textContent = timeElapsed.toFixed(2);
            document.getElementById('finalTotal').textContent = gameState.totalLetters;
            document.getElementById('finalErrors').textContent = gameState.errorCount;

            if (playerRank === 1) {
                document.getElementById('gameOverTitle').textContent = 'ğŸ† èƒœåˆ©ï¼';
                document.getElementById('gameResult').innerHTML = '<span class="winner">ä½ èµ¢å¾—äº†æ¯”èµ›ï¼</span>';
            } else {
                document.getElementById('gameOverTitle').textContent = 'æ¯”èµ›ç»“æŸ';
                document.getElementById('gameResult').innerHTML = `<span class="loser">ä½ è·å¾—ç¬¬ ${playerRank} å</span>`;
            }

            gameOverEl.style.display = 'block';
        }

        // äº‹ä»¶ç›‘å¬
        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetGame);
        document.addEventListener('keydown', handleKeyPress);

        // åˆå§‹åŒ–
        currentLetterEl.textContent = 'A';
    </script>
</body>
</html>
